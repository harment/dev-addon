<!-- admin:xbt_admin_torrents -->
<xf:title>{{ phrase('xbt_manage_torrents') }}</xf:title>

<xf:pageaction>
    <xf:button href="{{ link('torrents/torrent-add') }}" icon="add" overlay="true">{{ phrase('xbt_add_torrent') }}</xf:button>
    <xf:button href="{{ link('torrents') }}" icon="view" overlay="false">{{ phrase('view_torrents') }}</xf:button>
</xf:pageaction>

<div class="block">
    <div class="block-container">
        <div class="block-header">
            <h2 class="block-header-title">{{ phrase('search_torrents') }}</h2>
        </div>
        <div class="block-body">
            <xf:form action="{{ link('torrents/torrents') }}" class="block">
                <div class="block-filterBar">
                    <div class="filterBar">
                        <xf:textbox name="search" value="{{ $search }}" placeholder="{{ phrase('search') }}..." />
                        
                        <xf:select name="category_id" value="{{ $categoryId }}">
                            <xf:option value="0">{{ phrase('all_categories') }}</xf:option>
                            <xf:foreach loop="$categories" value="$category">
                                <xf:option value="{$category.category_id}">{$category.title}</xf:option>
                            </xf:foreach>
                        </xf:select>
                        
                     <xf:select name="user_id" value="{{ $userId }}">
    <xf:option value="0">{{ phrase('all_users') }}</xf:option>
    <xf:option value="{$userId}" selected="{{ $userId ? true : false }}">
        {{ phrase('selected_user') }}
    </xf:option>
</xf:select>
                        
                        <xf:select name="status" value="{{ $status }}">
                            <xf:option value="">{{ phrase('all_statuses') }}</xf:option>
                            <xf:option value="active">{{ phrase('active') }}</xf:option>
                            <xf:option value="dead">{{ phrase('dead') }} (0 {{ phrase('seeders') }})</xf:option>
                            <xf:option value="freeleech">{{ phrase('xbt_freeleech') }}</xf:option>
                        </xf:select>
                        
                        <xf:select name="sort" value="{{ $sort }}">
                            <xf:option value="date">{{ phrase('date') }}</xf:option>
                            <xf:option value="seeds">{{ phrase('seeders') }}</xf:option>
                            <xf:option value="leechers">{{ phrase('leechers') }}</xf:option>
                            <xf:option value="size">{{ phrase('size') }}</xf:option>
                            <xf:option value="completed">{{ phrase('completed') }}</xf:option>
                            <xf:option value="title">{{ phrase('title') }}</xf:option>
                        </xf:select>
                        
                        <xf:select name="order" value="{{ $order }}">
                            <xf:option value="desc">{{ phrase('desc') }}</xf:option>
                            <xf:option value="asc">{{ phrase('asc') }}</xf:option>
                        </xf:select>
                        
                        <xf:button type="submit" icon="search">{{ phrase('filter') }}</xf:button>
                    </div>
                </div>
            </xf:form>
        </div>
    </div>
</div>

<div class="block">
    <div class="block-container">
        <div class="block-header">
            <h2 class="block-header-title">{{ phrase('xbt_torrents') }}</h2>
            <div class="block-header-controls">
                <xf:if is="$totalTorrents">
                    <span class="block-header-control">
                        <span class="u-muted">{{ phrase('displaying_x_of_y_items', {
                            'count': count($torrents),
                            'total': $totalTorrents
                        }) }}</span>
                    </span>
                </xf:if>
            </div>
        </div>
        <div class="block-body">
            <xf:if is="$torrents is empty">
                <div class="block-row">{{ phrase('xbt_no_torrents_found') }}</div>
            <xf:else />
                <div class="structItemContainer">
                    <xf:foreach loop="$torrents" value="$torrent">
                        <div class="structItem structItem--torrent">
                            <div class="structItem-cell structItem-cell--icon">
                                <div class="structItem-iconContainer">
                                    <a href="{{ link('torrents', $torrent) }}" target="_blank">
                                        <xf:if is="$torrent.poster_url">
                                            <img src="{{ $torrent.poster_url }}" alt="{$torrent.title}" class="structItem-poster" />
                                        <xf:else />
                                            <i class="structItem-placeholder fa fa-file-video fa-3x"></i>
                                        </xf:if>
                                    </a>
                                </div>
                            </div>
                            <div class="structItem-cell structItem-cell--main">
                                <div class="structItem-title">
                                    <a href="{{ link('torrents', $torrent) }}" target="_blank">{$torrent.title}</a>
                                    <xf:if is="$torrent.is_freeleech">
                                        <span class="label label--primary">{{ phrase('xbt_freeleech') }}</span>
                                    </xf:if>
                                </div>
                                <div class="structItem-minor">
                                    <ul class="structItem-parts">
                                        <li>{{ phrase('uploaded_by', { 'name': $torrent.User ? $torrent.User.username : phrase('unknown'), 'link': $torrent.User ? link('members', $torrent.User) : '' }) }}</li>
                                        <li>{{ phrase('xbt_category', { 'name': $torrent.Category.title, 'link': link('torrents/torrents', null, { 'category_id': $torrent.category_id }) }) }}</li>
                                        <li>{{ phrase('xbt_uploaded_on', { 'date': date_time($torrent.creation_date) }) }}</li>
                                    </ul>
                                    <ul class="structItem-parts structItem-parts--torrentTags">
                                        <xf:if is="$torrent.video_quality AND isset($torrent.video_quality_badge)">
                                            <li>
                                                <span class="labelTorrent labelTorrent--{{ $torrent.video_quality_badge.class }}">
                                                    <i class="fa {{ $torrent.video_quality_badge.icon }}"></i>
                                                    {{ $torrent.video_quality_badge.text }}
                                                </span>
                                            </li>
                                        </xf:if>
                                        <xf:if is="$torrent.audio_format AND isset($torrent.audio_format_badge)">
                                            <li>
                                                <span class="labelTorrent labelTorrent--{{ $torrent.audio_format_badge.class }}">
                                                    <i class="fa {{ $torrent.audio_format_badge.icon }}"></i>
                                                    {{ $torrent.audio_format_badge.text }}
                                                </span>
                                            </li>
                                        </xf:if>
                                        <xf:if is="$torrent.audio_channels AND isset($torrent.audio_channels_badge)">
                                            <li>
                                                <span class="labelTorrent labelTorrent--{{ $torrent.audio_channels_badge.class }}">
                                                    <i class="fa fa-volume-up"></i>
                                                    {{ $torrent.audio_channels }}
                                                </span>
                                            </li>
                                        </xf:if>
                                    </ul>
                                </div>
                            </div>
                            <div class="structItem-cell structItem-cell--stats">
                                <div class="structItem-statuses">
                                    <dl class="pairs pairs--justified">
                                        <dt>{{ phrase('xbt_size') }}</dt>
                                        <dd>{$torrent.size_formatted}</dd>
                                    </dl>
                                    <dl class="pairs pairs--justified">
                                        <dt>{{ phrase('xbt_seeders') }}</dt>
                                        <dd class="pairs-value--{{ $torrent.seeders ? 'seeders' : 'noSeeders' }}">{$torrent.seeders}</dd>
                                    </dl>
                                    <dl class="pairs pairs--justified">
                                        <dt>{{ phrase('xbt_leechers') }}</dt>
                                        <dd>{$torrent.leechers}</dd>
                                    </dl>
                                    <dl class="pairs pairs--justified">
                                        <dt>{{ phrase('xbt_completed') }}</dt>
                                        <dd>{$torrent.completed}</dd>
                                    </dl>
                                </div>
                            </div>
                            <div class="structItem-cell structItem-cell--actions">
                                <div class="structItem-actions">
                                    <a href="{{ link('torrents/torrent-edit', $torrent) }}" class="menu-linkRow"
                                       data-xf-click="overlay">{{ phrase('edit') }}</a>
                                    <a href="{{ link('torrents/torrent-delete', $torrent) }}" class="menu-linkRow"
                                       data-xf-click="overlay">{{ phrase('delete') }}</a>
                                    <a href="{{ link('torrents', $torrent) }}" class="menu-linkRow" target="_blank">{{ phrase('view') }}</a>
                                    <xf:if is="$torrent.seeders == 0">
                                        <a href="{{ link('torrents/reseed-request', $torrent) }}" class="menu-linkRow"
                                           data-xf-click="overlay">{{ phrase('xbt_reseed_request') }}</a>
                                    </xf:if>
                                </div>
                            </div>
                        </div>
                    </xf:foreach>
                </div>
            </xf:if>
        </div>
        
       <xf:pagenav page="{$page}" perpage="{$perPage}" total="{$totalTorrents}" link="torrents/torrents" 
           params="{'category_id': $categoryId, 'search': $search, 'user_id': $userId, 'status': $status, 'sort': $sort, 'order': $order}" />
    </div>
</div>

<div class="block">
    <div class="block-container">
        <div class="block-header">
            <h2 class="block-header-title">{{ phrase('xbt_bulk_actions') }}</h2>
        </div>
        <div class="block-body">
            <xf:form action="{{ link('torrents/torrents/bulk-actions') }}" class="block">
                <div class="block-row">
                    <div class="formRow">
                        <div class="formRow-label">{{ phrase('xbt_bulk_action') }}:</div>
                        <div class="formRow-input">
                            <div class="inputGroup">
                                <xf:select name="action">
                                    <xf:option value="enable_freeleech">{{ phrase('xbt_enable_freeleech') }}</xf:option>
                                    <xf:option value="disable_freeleech">{{ phrase('xbt_disable_freeleech') }}</xf:option>
                                    <xf:option value="delete">{{ phrase('delete') }}</xf:option>
                                </xf:select>
                                <span class="inputGroup-splitter"></span>
                                <xf:select name="filter" class="input--autoSize">
                                    <xf:option value="all">{{ phrase('all_torrents') }}</xf:option>
                                    <xf:option value="dead">{{ phrase('dead_torrents') }} (0 {{ phrase('seeders') }})</xf:option>
                                    <xf:option value="inactive">{{ phrase('inactive_torrents') }} ({$inactiveDays} {{ phrase('days') }})</xf:option>
                                    <xf:option value="current">{{ phrase('current_filtered_torrents') }}</xf:option>
                                </xf:select>
                                <span class="inputGroup-splitter"></span>
                                <xf:button type="submit" icon="action">{{ phrase('apply') }}</xf:button>
                            </div>
                            <div class="formRow-explain">{{ phrase('xbt_bulk_action_explain') }}</div>
                        </div>
                    </div>
                </div>
                
                <xf:hiddenval name="category_id">{$categoryId}</xf:hiddenval>
                <xf:hiddenval name="search">{$search}</xf:hiddenval>
                <xf:hiddenval name="user_id">{$userId}</xf:hiddenval>
                <xf:hiddenval name="status">{$status}</xf:hiddenval>
                <xf:hiddenval name="sort">{$sort}</xf:hiddenval>
                <xf:hiddenval name="order">{$order}</xf:hiddenval>
            </xf:form>
        </div>
    </div>
</div>

<div class="block">
    <div class="block-container">
        <div class="block-header">
            <h2 class="block-header-title">{{ phrase('xbt_tracker_statistics') }}</h2>
        </div>
        <div class="block-body">
            <div class="block-row">
                <div class="pairRows">
                    <dl class="pairs pairs--columns pairs--fixedSmall">
                        <dt>{{ phrase('xbt_total_torrents') }}</dt>
                        <dd>{$trackerStats.total_torrents}</dd>
                    </dl>
                    <dl class="pairs pairs--columns pairs--fixedSmall">
                        <dt>{{ phrase('xbt_active_torrents') }}</dt>
                        <dd>{$trackerStats.active_torrents}</dd>
                    </dl>
                    <dl class="pairs pairs--columns pairs--fixedSmall">
                        <dt>{{ phrase('xbt_dead_torrents') }}</dt>
                        <dd>{$trackerStats.dead_torrents}</dd>
                    </dl>
                    <dl class="pairs pairs--columns pairs--fixedSmall">
                        <dt>{{ phrase('xbt_total_seeders') }}</dt>
                        <dd>{$trackerStats.total_seeders}</dd>
                    </dl>
                    <dl class="pairs pairs--columns pairs--fixedSmall">
                        <dt>{{ phrase('xbt_total_leechers') }}</dt>
                        <dd>{$trackerStats.total_leechers}</dd>
                    </dl>
                    <dl class="pairs pairs--columns pairs--fixedSmall">
                        <dt>{{ phrase('xbt_total_data') }}</dt>
                        <dd>{$trackerStats.total_data|file_size}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</div>